language: rust
sudo: false
script:
  - 'if [ "$WITH_LOCK" != "true" ]; then rm -f Cargo.lock; fi'
  - "cargo test --verbose --no-default-features && \
     cargo test --verbose && \
     cargo test --verbose --all-features"
cache:
  directories:
    - target/debug/deps
    - target/debug/build

env: # important!
matrix:
  include:
    - rust: 1.26.2
      os: osx
      env: WITH_LOCK=true
    - rust: stable
      os: osx
      env: WITH_LOCK=true
    - rust: 1.26.2
      env: WITH_LOCK=true
    - rust: 1.26.2
    - rust: stable
      env: WITH_LOCK=true
    - rust: nightly
      env: WITH_LOCK=true
    - rust: beta
      env: MAY_FAIL=true
    - rust: nightly
      env: MAY_FAIL=true
  allow_failures:
    - env: MAY_FAIL=true
