language: rust
dist: xenial
script:
  - 'cargo test  --manifest-path body-image/Cargo.toml --no-default-features'
  - 'cargo test  --manifest-path body-image/Cargo.toml --all-features'
  - 'cargo test  --manifest-path barc/Cargo.toml --no-default-features'
  - 'cargo test  --manifest-path barc/Cargo.toml --no-default-features --features mmap'
  - 'cargo test  --manifest-path barc/Cargo.toml --no-default-features --features brotli'
  - 'cargo test  --manifest-path barc/Cargo.toml --all-features'
  - 'cargo test  --manifest-path body-image-futio/Cargo.toml --no-default-features'
  - 'cargo test  --manifest-path body-image-futio/Cargo.toml --no-default-features --features mmap'
  - 'cargo test  --manifest-path body-image-futio/Cargo.toml --no-default-features --features brotli'
  - 'cargo test  --manifest-path body-image-futio/Cargo.toml'
  - 'if [ "$MAY_FAIL" == "true" ]; then cargo test --manifest-path body-image-futio/Cargo.toml --all-features; fi'
  - 'cargo build --manifest-path barc-cli/Cargo.toml --no-default-features'
  - 'cargo build --manifest-path barc-cli/Cargo.toml --no-default-features --features mmap'
  - 'cargo build --manifest-path barc-cli/Cargo.toml --no-default-features --features brotli'
  - 'cargo build --manifest-path barc-cli/Cargo.toml --no-default-features --features futio'
  - 'cargo build --manifest-path barc-cli/Cargo.toml --all-features'

# See https://levans.fr/rust_travis_cache.html
cache:
  directories:
    - /home/travis/.cargo
before_cache:
  - rm -rf /home/travis/.cargo/registry

env: # important!
matrix:
  include:
    - rust: 1.39.0
    - rust: stable
    - rust: nightly
    - rust: 1.39.0
      os: osx
